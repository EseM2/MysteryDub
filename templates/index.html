<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcriptor y Traductor en Tiempo Real</title>
    <style>
        /* Estilos para el overlay */
        .overlay {
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 20px;
            text-align: center;
            font-size: 1.5rem;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        .visible {
            opacity: 1;
        }
    </style>
</head>
<body>
    <h1>Transcriptor y Traductor en Tiempo Real</h1>

    <!-- Botón para iniciar la transcripción de audio -->
    <button id="startButton">Iniciar Transcripción</button>

    <!-- Selección del idioma de traducción -->
    <label for="language">Idioma de traducción:</label>
    <select id="language">
        <option value="en">Inglés</option>
        <option value="fr">Francés</option>
        <option value="de">Alemán</option>
        <!-- Agrega más opciones si deseas más idiomas -->
    </select>

    <!-- Overlay donde se mostrará el texto transcrito y traducido -->
    <div id="overlay" class="overlay">
        <p id="transcriptText"></p>
        <p id="translatedText"></p>
    </div>

    <script>
        // Verificar si el navegador soporta SpeechRecognition
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) {
            alert('Tu navegador no soporta SpeechRecognition. Usa Chrome o Edge.');
        } else {
            const recognition = new SpeechRecognition();
            recognition.lang = 'es-ES';  // Cambia según el idioma de entrada
            recognition.interimResults = true;
            recognition.continuous = true;

            const startButton = document.getElementById('startButton');
            const overlay = document.getElementById('overlay');
            const transcriptText = document.getElementById('transcriptText');
            const translatedText = document.getElementById('translatedText');
            const languageSelect = document.getElementById('language');

            let isListening = false;

            // Función para iniciar o detener la grabación
            startButton.onclick = () => {
                if (!isListening) {
                    recognition.start();
                    startButton.innerText = 'Detener Transcripción';
                } else {
                    recognition.stop();
                    startButton.innerText = 'Iniciar Transcripción';
                }
                isListening = !isListening;
            };

            // Evento que se activa cuando hay resultados de la transcripción
            recognition.onresult = async (event) => {
                const interimTranscript = Array.from(event.results)
                    .map(result => result[0].transcript)
                    .join('');

                transcriptText.innerText = `Transcripción: ${interimTranscript}`;
                overlay.classList.add('visible');

                if (event.results[0].isFinal) {
                    try {
                        // Obtener idioma de traducción
                        const targetLanguage = languageSelect.value;

                        // Enviar la transcripción final al backend para traducir
                        const response = await fetch('/translate', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                transcript: interimTranscript,
                                language: targetLanguage
                            })
                        });
                        const result = await response.json();

                        // Mostrar la traducción en el overlay
                        if (response.ok) {
                            translatedText.innerText = `Traducción: ${result.translated_text}`;
                        } else {
                            translatedText.innerText = 'Error en la traducción.';
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        translatedText.innerText = 'Error en el procesamiento.';
                    }
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech Recognition Error:', event.error);
            };
        }
    </script>
</body>
</html>
